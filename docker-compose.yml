version: "3.9"

services:
  autoclock:
    container_name: autoclock
    build:
      context: .
      dockerfile: Dockerfile

    # Always restart unless manually stopped
    restart: unless-stopped

    # Timezone
    environment:
      - TZ=Asia/Kolkata

    # Persist state DB and images
    volumes:
      - /home/smartboys/KREDAUTO/state:/app/state
      - /home/smartboys/KREDAUTO/images:/app/images

    # Optional: limit CPU/RAM
    # deploy:
    #   resources:
    #     limits:
    #       cpus: "0.30"
    #       memory: 300M

    # Healthcheck ensures the script is alive
    healthcheck:
      test: ["CMD", "python", "-c", "import os; os.path.exists('/app/state/autoclock.db')"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 20s
